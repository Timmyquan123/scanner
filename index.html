<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wedding Guest Check-In</title>

  <!-- html5-qrcode library -->
  <script src="https://unpkg.com/html5-qrcode"></script>

  <style>
    :root{
      --bg1:#fff8f0; --bg2:#f8e7db; --gold:#b88a5b; --accent:#7b6a58;
      --glass: rgba(255,255,255,0.85);
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#3e2f26;padding:20px;
    }

    .card{
      width:100%;
      max-width:420px;
      background:var(--glass);
      border-radius:18px;
      box-shadow:0 10px 40px rgba(0,0,0,0.12);
      padding:18px;
      text-align:center;
      backdrop-filter: blur(6px);
    }

    header{
      border-bottom:1px solid rgba(184,138,91,0.12);
      padding-bottom:12px;margin-bottom:12px;
    }
    h1{margin:0;font-size:1.25rem;color:var(--gold);}
    p.lead{margin:6px 0 0;color:var(--accent);font-size:0.95rem;}

    #reader{
      width:100%;
      height:320px;
      border-radius:12px;
      overflow:hidden;
      margin:14px 0;
      box-shadow:0 8px 30px rgba(184,138,91,0.08);
      border:3px solid rgba(184,138,91,0.12);
    }

    .result{
      min-height:54px;
      display:flex;align-items:center;justify-content:center;
      border-radius:10px;padding:10px 12px;
      font-weight:600;
      transition:all .25s ease;
      margin-top:10px;
    }
    .result.success{ background:#e6f6ec;color:#14522a;border:1px solid rgba(20,82,42,0.08); }
    .result.warn{ background:#fff8e6;color:#665012;border:1px solid rgba(102,80,18,0.06); }
    .result.error{ background:#fff0f0;color:#7a1d24;border:1px solid rgba(122,29,36,0.06); }

    .controls{display:flex;gap:10px;justify-content:center;margin-top:12px;}
    button{
      padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
      transition:transform .12s ease;
    }
    button:active{transform:translateY(1px);}
    .btn-start{ background:linear-gradient(90deg,#b88a5b,#d2a36a); color:white; }
    .btn-stop{ background:transparent; color:var(--accent); border:1px solid rgba(0,0,0,0.06); }

    footer{margin-top:12px;font-size:0.85rem;color:var(--accent);}
    .hint { font-size:0.9rem;color:#8b7766;margin-top:8px; }
  </style>
</head>
<body>

  <div class="card">
    <header>
      <h1>üíç Vaclav & Juliet ‚Äî Guest Check-In</h1>
      <p class="lead">Open camera and scan the QR on the invitation</p>
    </header>

    <div id="reader"></div>

    <div id="result" class="result" style="background:transparent;color:var(--accent);min-height:48px;">
      Ready to scan ‚Äî allow camera access
    </div>

    <div class="controls">
      <button id="startBtn" class="btn-start">Start Scanning</button>
      <button id="stopBtn" class="btn-stop">Stop</button>
    </div>

    <p class="hint">Tip: Use a tablet for faster scanning and nicer UX.</p>
    <footer>With love üíñ ‚Äî Wedding Guest Check-In</footer>
  </div>

  <script>
    let html5QrCode;
    const readerId = "reader";
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const resultEl = document.getElementById("result");

    function showMessage(text, type) {
      resultEl.textContent = text;
      resultEl.classList.remove("success","warn","error");
      if (type === "success") resultEl.classList.add("success");
      if (type === "warn") resultEl.classList.add("warn");
      if (type === "error") resultEl.classList.add("error");
    }

    async function onScanSuccess(decodedText, decodedResult) {
      // Validate QR code format
      if (!decodedText.startsWith("https://script.google.com/macros/s/AKfycbyR-ZDglXImKX1m87toVJRfU8X29K4jbqGieU8PAv1KQX_-5qxRjQ1Ox38DuLxlMsBpBg/exec")) {
        showMessage("‚ùå Invalid QR code ‚Äî not a guest link", "error");
        return;
      }

      // Stop scanning after one scan
      if (html5QrCode) {
        try {
          await html5QrCode.stop();
          await html5QrCode.clear();
        } catch(e) {
          console.error("Error stopping scanner:", e);
        }
      }

      showMessage("Opening guest check-in‚Ä¶", "success");
      window.open(decodedText, "_blank");

      // Scanner does NOT restart ‚Äî must click start again manually
    }

    function onScanFailure(error) {
      // Optional: ignore or log errors
    }

    function startScanner() {
      if (html5QrCode && html5QrCode.getState() === Html5QrcodeScannerState.SCANNING) {
        return; // already scanning
      }

      html5QrCode = new Html5Qrcode(readerId, false);

      const config = { fps: 10, qrbox: { width: 280, height: 280 }, facingMode: "environment" };

      html5QrCode.start(
        { facingMode: "environment" },
        config,
        onScanSuccess,
        onScanFailure
      ).then(() => {
        showMessage("üì∑ Scanning ‚Äî point camera at guest QR", null);
      }).catch(err => {
        showMessage("‚ùå Camera access denied or unavailable. Try HTTPS/localhost.", "error");
        console.error(err);
      });
    }

    function stopScanner() {
      if (!html5QrCode) {
        showMessage("Scanner not active", "error");
        return;
      }
      html5QrCode.stop().then(() => {
        html5QrCode.clear();
        showMessage("üî¥ Scanning stopped", "error");
      }).catch(err => {
        console.error(err);
        showMessage("Error stopping scanner", "error");
      });
    }

    startBtn.addEventListener("click", startScanner);
    stopBtn.addEventListener("click", stopScanner);
  </script>
</body>
</html>

